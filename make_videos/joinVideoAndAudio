import ffmpeg
import random
import os
import glob
def buildVideo(backroundAudio, VoiceAudio,Video,finalpath):

    input_video = ffmpeg.input(Video)
    
    input_audio1 = ffmpeg.input(VoiceAudio)
    input_audio2 = ffmpeg.input(backroundAudio)
    # Cut out the first 8 seconds of the audio
    # Get the duration of the first audio file
    audio1_duration = float(ffmpeg.probe(VoiceAudio)['streams'][0]['duration'])

    # Repeat the second audio file until it's as long as the first audio file
    audio2 = input_audio2.audio.filter_('atrim', duration=audio1_duration).filter_('aloop', loop=-1).filter_('loudnorm', I=-37, LRA=11, TP=-1.5)
    audio2 = ffmpeg.filter(audio2, 'atrim', start=7)  

    # Mix the two audio streams
    audio = ffmpeg.filter_([input_audio1.audio, audio2], 'amix')

    # Combine the video and the mixed audio
    output = ffmpeg.output(input_video.video, audio, finalpath+'\output.mp4')
    
    
  
    # Run the command
    ffmpeg.run(output)
    
scp = '014'
baseDir= f'C:\\Users\\Abdul\\Videos\\Youtube\\SCP_Channel\\{scp}'
audio= baseDir+'\\concatenated_audio.wav'
video = f"C:\\Users\\Abdul\\Videos\\Youtube\\SCP_Channel\\{scp}\\animated\\Final\\output-crossfade.mp4"

backroundAudio = r'C:\Users\Abdul\VSCODE_Projects\Youtube-Generator\Background\from-beyond-royalty-free-no-copyright-background-music(1).wav'
buildVideo(backroundAudio,audio,video,baseDir)
